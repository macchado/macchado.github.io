<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"> </script>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

		<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		
		<style type="text/css">
			 /* {font-family: 'Roboto'} */
			div{padding: 10px}
		</style>
		<script> 
			var dados = [];
			$(function () {
			    function getFoxBit() {
			        var jsonURL = 'https://api.blinktrade.com/api/v1/BRL/ticker?crypto_currency=BTC&callback=?';
			        $.getJSON(jsonURL,
			        function (result) {
			            dados = result;			        	
				    upTitle(result.sell);
				    textQuote(dados);
			            calc();
			        });
			    }
			    var timer = setInterval(getFoxBit, 30000);
			    getFoxBit();
			});

			function upTitle(btc){
			    document.title = "Bitcoin: R$ "+btc;
			}

			function calc(){
				var total_btc_comprado = 0;
				var total_btc_vender = 0;
				var total_prejuizo = 0;
				var taxa_btc_compra = 0;
				var taxa_btc_venda = 0;
				var total_valor_vender = 0;

				var valor_investido_btc = $("#valorbtc").val().replace(',','.'); 
				var valor = $("#valor").val().replace(',','.') * 1; 
				var valor_taxa_compra = 0;
				var valor_taxa_venda = 0;

				if(valor_investido_btc > 0){
					valor = valor_investido_btc * dados.sell;
				}else{
					valor_investido_btc = valor / dados.sell;					
				} 
				
				//compra
				taxa_btc_compra = getFee(valor_investido_btc);
				total_btc_comprado = valor_investido_btc - taxa_btc_compra;
				valor_taxa_compra = taxa_btc_compra * dados.buy;

				//venda
				taxa_btc_venda = getFee(total_btc_comprado);
				total_btc_vender = total_btc_comprado - taxa_btc_venda;
				valor_taxa_venda = taxa_btc_venda * dados.buy;

				total_valor_vender = total_btc_vender * dados.buy;
				total_prejuizo = valor - total_valor_vender;

				var data = {};

				data.total_btc_comprado = total_btc_comprado.toFixed(2);
				data.valor = valor.toFixed(2);
				data.valor_taxa_compra = valor_taxa_compra.toFixed(2);
				data.taxa_btc_compra = taxa_btc_compra;
				data.total_valor_vender = total_valor_vender.toFixed(2);
				data.valor_taxa_compra = valor_taxa_compra.toFixed(2);
				data.taxa_btc_venda = taxa_btc_venda;
				data.total_prejuizo = total_prejuizo.toFixed(2);
				data.total_btc_comprado  = total_btc_comprado;
				data.vendaMinima = vendaMinima(total_btc_comprado, valor).toFixed(2);

				textSimulation(data);
			}

			function textQuote(data){
				var diff = data.sell - data.buy;
				var html = "";

	            html += "<br/>Neste momento você compra <b>1</b> Bitcoin por R$ <b>" + data.sell + "</b>\
	             <br/>e vende por R$ " + data.buy + ", a diferença é R$ " + diff.toFixed(2)+"<br/><br/>\
	             O valor do Bitcoin nas últimas 24 horas ficou entre <b>R$ " + data.high +  "</b> e R$ <b>" + data.low+ "</b>";

	            $('#fox').html(html);
			}

			function textSimulation(data)
			{
				var html = "Descontando as taxa de compra você terá <b>"+data.total_btc_comprado + "</b> bitcoins<br/><br/>\
							Você irá pagar R$ "+data.valor+"<br/><br/>\
			 				Ao comprar será cobrada uma taxa R$ "+data.valor_taxa_compra+ " / BTC "+data.taxa_btc_compra+"<hr/>\
			 				Se você vender seus bitcoins pelo mesmo valor você receberá R$ "+data.total_valor_vender+"<br/><br/>\
			 				Será cobrada uma taxa R$ "+data.valor_taxa_compra+ " / BTC "+data.taxa_btc_venda+"<br/><br/>\
			 				Assim você irá perder R$ -"+data.total_prejuizo+"<br/><br/>\
			 				A cotação ideal para venda é de: R$ "+data.vendaMinima;

 				$("#investimento").html(html);
			}

			function vendaMinima(totalBtc, valorInvestido){
				var cotacaoIdeal = valorInvestido / totalBtc;
				cotacaoIdeal = cotacaoIdeal + getFee(totalBtc);
				return cotacaoIdeal;
			}

			function getFee(valor)
			{
				var taxa = 0.50;
				var valorTaxa = (taxa / 100) * valor;
				//var valorFinal = valor - valorTaxa;

				//console.log(valor);
				//console.log(valorTaxa);
				//console.log(valorFinal);

				return valorTaxa;
			}

			function change(campo){
				if(campo == 'valorbtc'){
					$("#valor").val(0);
				}else{
					$("#valorbtc").val(0);
				}
			}
		</script>
	</head>
	<body>

		<div class="container">
		  <div id="fox"></div>


		  <hr/>

		  &nbsp;&nbsp;Investindo agora &nbsp;&nbsp; 
		  <input type="text" name="valorbtc" id="valorbtc" value="1" size="6" onchange="change(this.id);calc()" /> Bitcoin
		  ou R$ <input type="text" name="valor" id="valor" value="0" size="10"  onchange="change(this.id);calc()" />  
		  <div id="investimento"></div>

	 	</div>
	

	 <script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-3937335-3']);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
	</body>
</html>
