<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"> </script>
		<style type="text/css">
			* {font-family: 'Roboto'}
			div{padding: 10px}
		</style>
		<script> 
			var dados = [];
			$(function () {
			    function getFoxBit() {
			        var jsonURL = 'https://api.blinktrade.com/api/v1/BRL/ticker?crypto_currency=BTC&callback=?';
			        $.getJSON(jsonURL,
			        function (result) {
			        	dados = result;
			        	var diff = result.sell - result.buy;
					document.title = "Bitcoin: R$ "+result.sell;
					
			            var html = "";
			            //html += "<br/>Moeda : R$ " + result.pair;
			            //html += "<br/>Mercado BTC : " + result.vol;
			           // html += "<br/>Mercado em R$ : R$ " + result.vol_brl;
			            //html += "<hr/>";
			            //html += "<br/>Valor da última venda: R$ " + result.last;
			            //html += "<hr/>";
			            html += "<br/>Valor de venda entre R$ " + result.high +  " e R$ " + result.low
			            + "<br/><br/>Neste momento você compra 1 Bitcoin por R$ <b>" + result.sell + "</b> e vende por R$ " + result.buy
			            + "<br/><br/>Resultando numa diferença entre compra e venda de R$ <b>" + diff.toFixed(2) + '</b>';
			            $('#fox').html(html);

			            calc();
			        });
			    }
			    var timer = setInterval(getFoxBit, 30000);
			    getFoxBit();
			});

			function calc(){
				var total_btc_comprado = 0;
				var total_btc_vender = 0;
				var total_prejuizo = 0;
				var taxa_btc_compra = 0;
				var taxa_btc_venda = 0;
				var total_valor_vender = 0;

				var valor_investido_btc = $("#valorbtc").val().replace(',','.'); 
				var valor = $("#valor").val().replace(',','.'); 
				var valor_taxa_compra = 0;
				var valor_taxa_venda = 0;

				if(valor_investido_btc > 0){
					valor = valor_investido_btc * dados.sell;
				}else{
					valor_investido_btc = valor / dados.sell;					
				} 
				
				//compra
				taxa_btc_compra = getTaxa(valor_investido_btc);
				total_btc_comprado = valor_investido_btc - taxa_btc_compra;
				valor_taxa_compra = taxa_btc_compra * dados.buy;

				//venda
				taxa_btc_venda = getTaxa(total_btc_comprado);
				total_btc_vender = total_btc_comprado - taxa_btc_venda;
				valor_taxa_venda = taxa_btc_venda * dados.buy;

				total_valor_vender = total_btc_vender * dados.buy;
				total_prejuizo = valor - total_valor_vender;


				var html = "Descontando as taxa de compra você terá <b>"+total_btc_comprado + "</b> bitcoins ";
 				html += "<br/><br/>Você irá pagar R$ "+valor;
 				html += "<br/><br/>Ao comprar será cobrada uma taxa R$ "+valor_taxa_compra.toFixed(2)+ " / BTC "+taxa_btc_compra;
 				html += "<hr/>";
 				html += "Se você vender seus bitcoins pelo mesmo valor, você receberá R$ "+total_valor_vender.toFixed(2);
 				html += "<br/><br/>Será cobrada uma taxa R$ "+valor_taxa_compra.toFixed(2)+ " / BTC "+taxa_btc_venda;
 				html += "<br/><br/>Assim você irá perder R$ -"+total_prejuizo.toFixed(2);
 				html += "<br/><br/>A cotação ideal para venda é: R$ "+vendaMinima(total_btc_comprado, valor).toFixed(2);

				$("#investimento").html(html);

				//$("#valorbtc").val(valorBTC); 
				//$("#valor").val(valor);
			}

			function vendaMinima(totalBtc, valorInvestido){
				var cotacaoIdeal = valorInvestido / totalBtc;
				cotacaoIdeal = cotacaoIdeal + getTaxa(totalBtc);
				return cotacaoIdeal;
			}

			function getTaxa(valor)
			{
				var taxa = 0.50;
				var valorTaxa = (taxa / 100) * valor;
				//var valorFinal = valor - valorTaxa;

				//console.log(valor);
				//console.log(valorTaxa);
				//console.log(valorFinal);

				return valorTaxa;
			}

			function change(campo){
				if(campo == 'valorbtc'){
					$("#valor").val(0);
				}else{
					$("#valorbtc").val(0);
				}
			}
		</script>
	</head>
	<body>

	  <div id="fox"></div>


	  <hr/>

	  &nbsp;&nbsp;Investindo agora &nbsp;&nbsp; 
	  <input type="text" name="valorbtc" id="valorbtc" value="1" size="6" onchange="change(this.id);calc()" /> Bitcoin
	  ou R$ <input type="text" name="valor" id="valor" value="0" size="10"  onchange="change(this.id);calc()" />  
	  <div id="investimento"></div>
	

	 <script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-3937335-3']);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
	</body>
</html>
